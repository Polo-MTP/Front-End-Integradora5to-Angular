<div class="min-h-screen flex items-center justify-center bg-surface-1000 p-4 relative overflow-hidden">
  <!-- Efectos de fondo animados -->
  <div class="absolute inset-0 opacity-10">
    <div class="absolute top-10 left-10 w-32 h-32 bg-primary-500 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-20 right-20 w-40 h-40 bg-blue-500 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    <div class="absolute top-1/2 left-1/3 w-24 h-24 bg-cyan-500 rounded-full blur-2xl animate-pulse" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/4 right-1/4 w-28 h-28 bg-teal-500 rounded-full blur-3xl animate-pulse" style="animation-delay: 3s;"></div>
  </div>

  <div class="absolute inset-0 pointer-events-none">
    <div class="bubble bubble-1"></div>
    <div class="bubble bubble-2"></div>
    <div class="bubble bubble-3"></div>
    <div class="bubble bubble-4"></div>
    <div class="bubble bubble-5"></div>
    <div class="bubble bubble-6"></div>
  </div>

  <!-- Stepper Container -->
  <div class="w-full max-w-4xl relative z-10 ">
    <p-stepper [value]="currentStep" class="basis-full">
      <p-step-list>
        <p-step [value]="1" [disabled]="userRegistered">
          <span class="flex items-center">
            <i class="pi pi-user-plus mr-2"></i>
            Registro de Usuario
          </span>
        </p-step>
        <p-step [value]="2" [disabled]="!canAccessNextSteps">
          <span class="flex items-center">
            <i class="pi pi-info-circle mr-2"></i>
            Información
          </span>
        </p-step>
        <p-step [value]="3" [disabled]="!canAccessNextSteps">
          <span class="flex items-center">
            <i class="pi pi-heart mr-2"></i>
            Registro de Pecera
          </span>
        </p-step>
      </p-step-list>

      <p-step-panels>
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="pt-8">
              <p-card styleClass="w-full max-w-xl mx-auto shadow-2xl backdrop-blur-sm border border-surface-200 dark:border-surface-700 relative" 
                      header="Registro de Usuario" 
                      subheader="Crea tu cuenta">
              
              <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 z-20">
                <div class="bg-primary-500 w-16 h-16 rounded-full flex items-center justify-center shadow-lg">
                  <i class="pi pi-user-plus text-white text-2xl"></i>
                </div>
              </div>

              <form class="space-y-6 mt-8" [formGroup]="loginForm" (ngSubmit)="onSubmitUser()">
                <div class="relative">
                  <p-floatlabel>
                    <input
                      id="fullName"
                      pInputText
                      formControlName="fullName"
                      class="w-full pl-10 transition-all duration-300 hover:shadow-md focus:shadow-lg"
                      autocomplete="off"
                    />
                    <label for="fullName">Nombre Completo</label>
                  </p-floatlabel>
                </div>

                <div class="relative">
                  <p-floatlabel>
                    <input
                      id="email"
                      pInputText
                      formControlName="email"
                      class="w-full pl-10 transition-all duration-300 hover:shadow-md focus:shadow-lg"
                      autocomplete="off"
                    />
                    <label for="email">Correo electrónico</label>
                  </p-floatlabel>
                </div>

                <div class="relative">
                  <p-floatlabel>
                    <input
                      id="password"
                      type="password"
                      pInputText
                      formControlName="password"
                      class="w-full pl-10 transition-all duration-300 hover:shadow-md focus:shadow-lg"
                      autocomplete="off"
                    />
                    <label for="password">Contraseña</label>
                  </p-floatlabel>
                </div>

                <div class="relative">
                  <label class="block mb-3 text-sm font-medium text-surface-700 dark:text-surface-200 items-center">
                    <i class="pi pi-image mr-2 text-primary-500"></i>
                    Foto de perfil
                  </label>
                  <div class="relative group">
                    <p-fileUpload
                      mode="basic"
                      name="profileImage"
                      accept="image/*"
                      (onSelect)="onFileSelect($event)"
                      [auto]="false"
                      chooseLabel="Seleccionar archivo"
                      class="w-full"
                    />
                    <div class="absolute inset-0 border-2 border-dashed border-surface-300 dark:border-surface-600 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex items-center justify-center">
                      <div class="text-center">
                        <i class="pi pi-cloud-upload text-3xl text-surface-400 mb-2"></i>
                        <p class="text-sm text-surface-500">Arrastra tu imagen aquí</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="error" class="p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg text-sm border-l-4 border-red-500 animate-slideIn">
                  <i class="pi pi-exclamation-triangle mr-2"></i>
                  {{ error }}
                </div>

                <button
                  pButton
                  type="submit"
                  [loading]="loading"
                  class="w-full relative overflow-hidden group transition-all duration-300 hover:scale-105 active:scale-95"
                  [disabled]="!loginForm.valid || loading"
                >
                  <span class="absolute inset-0 bg-gradient-to-r from-primary-600 to-primary-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                  <span class="relative z-10 flex items-center justify-center">
                    <i class="pi pi-user-plus mr-2" *ngIf="!loading"></i>
                    Registrar Usuario
                  </span>
                </button>

                <div class="text-center mt-6 pt-4 border-t border-surface-200 dark:border-surface-700">
                  <a
                    routerLink="/login"
                    class="inline-flex items-center text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors duration-200 hover:underline"
                  >
                    <i class="pi pi-sign-in mr-1"></i>
                    ¿Ya tienes una cuenta? Inicia sesión
                  </a>
                </div>
              </form>
            </p-card>
            </div>
          </ng-template>
        </p-step-panel>

        <!-- Paso 2: Información -->
        <p-step-panel [value]="2" *ngIf="canAccessNextSteps">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="pt-8">
              <p-card styleClass="w-full max-w-xl mx-auto shadow-2xl backdrop-blur-sm border border-surface-200 dark:border-surface-700 relative" 
                      header="¡Registro Exitoso!" 
                      subheader="Completa tu experiencia">
              
              <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 z-20">
                <div class="bg-green-500 w-16 h-16 rounded-full flex items-center justify-center shadow-lg">
                  <i class="pi pi-check text-white text-2xl"></i>
                </div>
              </div>

              <div class="mt-8 text-center space-y-6">
                <div class="space-y-4">
                  <div class="bg-green-100 dark:bg-green-900/20 p-6 rounded-lg border border-green-200 dark:border-green-700">
                    <i class="pi pi-check-circle text-green-500 text-4xl mb-4"></i>
                    <h3 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-2">
                      ¡Tu cuenta ha sido creada exitosamente!
                    </h3>
                    <p class="text-green-600 dark:text-green-300 text-sm">
                      Ahora puedes personalizar tu experiencia agregando información sobre tu pecera.
                    </p>
                  </div>

                  <div class="bg-blue-50 dark:bg-blue-950/10 p-6 rounded-lg border border-blue-200 dark:border-blue-700">
                    <i class="pi pi-heart text-blue-500 text-4xl mb-4"></i>
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2">
                      ¿Quieres Hacer el pedido de un pecera?
                    </h3>
                    <p class="text-blue-600 dark:text-blue-300 text-sm mb-4">
                      Haz un pedido personalizado para tener una pecera inteligente de acuerdo con tus necesidades.
                    </p>
                    <p class="text-xs text-blue-500 dark:text-blue-400">
                      Este paso es completamente opcional y puedes hacerlo más tarde.
                    </p>
                  </div>
                </div>

                <div class="flex gap-4 justify-center pt-4">
                  <p-button 
                    label="Omitir" 
                    severity="danger"
                    icon="pi pi-times" 
                    (onClick)="skipAquarium()"
                    class="flex-1"
                  />
                  <p-button 
                    label="Registrar Pecera" 
                    icon="pi pi-arrow-right" 
                    iconPos="right" 
                    (onClick)="activateCallback(3)"
                    class="flex-1"
                  />
                </div>
              </div>
            </p-card>
            </div>
          </ng-template>
        </p-step-panel>

        <!-- Paso 3: Registro de Pecera (Opcional) -->
        <p-step-panel [value]="3" *ngIf="canAccessNextSteps">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="pt-8">
              <p-card styleClass="w-full max-w-4xl mx-auto shadow-2xl backdrop-blur-sm border border-surface-200 dark:border-surface-700 relative" 
                      header="Registro de Pecera" 
                      subheader="Cuéntanos sobre tu acuario y selecciona sensores (Opcional)">
              
              <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 z-20">
                <div class="bg-blue-500 w-16 h-16 rounded-full flex items-center justify-center shadow-lg">
                  <i class="pi pi-heart text-white text-2xl"></i>
                </div>
              </div>

              <form class="space-y-6 mt-8" [formGroup]="aquariumForm" (ngSubmit)="onSubmitAquarium()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="relative">
                    <p-floatlabel>
                      <input
                        id="aquariumName"
                        pInputText
                        formControlName="aquariumName"
                        autocomplete="off"
                        placeholder="Nombre de la Pecera"
                      />
                      <label for="aquariumName">Nombre de la Pecera</label>
                    </p-floatlabel>
                  </div>

                  <div class="relative">
                    <p-floatlabel>
                      <input
                        id="description"
                        pInputText
                        formControlName="description"
                        autocomplete="off"
                        placeholder="Describe tu acuario..."
                      >
                      <label for="description">Descripción</label>
                    </p-floatlabel>
                  </div>
                </div>

                <div class="mt-8">
                  <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-surface-700 dark:text-surface-200 flex items-center">
                      <i class="pi pi-cog mr-2 text-blue-500"></i>
                      Selecciona Sensores para tu Pecera
                    </h3>
                    <p-badge 
                      [value]="getTotalSensors() + '/' + MAX_SENSORS" 
                      severity="info"
                    />
                  </div>

                  <div *ngIf="loadingSensorTypes" class="flex items-center justify-center p-8">
                    <p-progressSpinner />
                    <span class="ml-3">Cargando tipos de sensores...</span>
                  </div>


                  <div *ngIf="sensorTypesError" class="p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg text-sm border-l-4 border-red-500 mb-4">
                    <i class="pi pi-exclamation-triangle mr-2"></i>
                    {{ sensorTypesError }}
                    <p-button 
                      label="Reintentar" 
                      size="small" 
                      class="ml-2" 
                      (onClick)="loadSensorTypes()"
                    />
                  </div>

                  <div *ngIf="!loadingSensorTypes && !sensorTypesError" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div 
                      *ngFor="let sensor of sensorTypes" 
                      class="border border-surface-200 dark:border-surface-700 rounded-lg p-4 hover:shadow-md transition-shadow duration-300"
                    >
                      <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium text-surface-700 dark:text-surface-200">
                          {{ sensor.name }}
                        </h4>
                      </div>

                      
                      <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                          <p-button 
                            icon="pi pi-minus" 
                            size="small" 
                            severity="secondary"
                            [disabled]="getSensorQuantity(sensor.id) === 0"
                            (onClick)="removeSensor(sensor.id)"
                          />
                          <span class="mx-2 font-medium min-w-[2rem] text-center">
                            {{ getSensorQuantity(sensor.id) }}
                          </span>
                          <p-button 
                            icon="pi pi-plus" 
                            size="small" 
                            severity="primary"
                            [disabled]="!canAddMoreSensors()"
                            (onClick)="addSensor(sensor.id)"
                          />
                        </div>
                        <p-badge 
                          *ngIf="getSensorQuantity(sensor.id) > 0"
                          [value]="getSensorQuantity(sensor.id)" 
                          severity="success"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="error" class="p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg text-sm border-l-4 border-red-500">
                  <i class="pi pi-exclamation-triangle mr-2"></i>
                  {{ error }}
                </div>

                <div class="flex gap-4 pt-4">
                  <p-button 
                    label="Volver" 
                    severity="secondary" 
                    icon="pi pi-arrow-left" 
                    (onClick)="activateCallback(2)"
                    class="flex-1"
                  />
                  <p-button 
                    type="submit"
                    label="Finalizar Registro" 
                    icon="pi pi-check" 
                    iconPos="right" 
                    [loading]="loading"
                    [disabled]="!aquariumForm.valid || !hasSensorsSelected() || loading"
                    class="flex-1"
                  />
                </div>
              </form>
            </p-card>
            </div>
          </ng-template>
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </div>
</div>